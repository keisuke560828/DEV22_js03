<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>


     <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
     <div>
        <div id="box"></div>
          <div id="output"></div>
          <div class="container">
              <div class="uname-area">
                åå‰ï¼š<input type="text" id="uname">
              </div>
              <div class="text-area">
                <textarea id="text"></textarea>
              </div>
              <div class="send-area">    
                <button id="send">é€ä¿¡</button>
              </div>
          </div>               
    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  
<!-- // æ¼”ç¿’ï¼‘
    // const è‡ªåˆ†ã®åå‰ = {} â†’ const morita = {}
    // name: 'xxxx',
    // syumi: 'xxxxx',
    // sukinamono: 'xxxxx',
    // console.log()ã§è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ğŸ¤—
        // ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚’ä½œã‚‹
    // ä»¥ä¸‹ã€ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ãƒ™ãƒ¼ã‚¹ -->

<script type="module">
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } 
from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyA1n1u2HuPXRmYcYyTnJswkcqvuVGoFlog",
    authDomain: "keisuke0828-6bc30.firebaseapp.com",
    projectId: "keisuke0828-6bc30",
    storageBucket: "keisuke0828-6bc30.appspot.com",
    messagingSenderId: "924728434304",
    appId: "1:924728434304:web:86b2e88a41aa3774801065"
  };

  // Initialize Firebase
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app); //RealtimeDBã«æ¥ç¶š
const dbRef = ref(db,"chat"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†ãƒ»å‚ç…§

// é€ä¿¡å‡¦ç†
// $('#send').on('click', function(){
//     //  alert(1)//å‹•ã„ãŸã‚‰alertã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼
//       // é€ä¿¡ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ğŸ¤—
      
//       const text = $('#text').val();
//       const uname = $('#uname').val();
      
//       const msg = {
//           uname = $("#uname").val(),
//           text = $("#text").val()
//     //   alert(uname+text);
//     //   å–å¾—ç¢ºèª
//     }
//     const newPostRef = push(dbRef);
//     set(newPostRef, msg);
//     });



// çµ„ã¿è¾¼ã¿é–¢æ•°ãƒ»JSã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ï¼‘ã¤
var day = new Date().toLocaleString();
document.getElementById("box").innerHTML = day;
// var today = new Date();
// console.log(
// today.getHours() + "æ™‚" + today.getMinutes() + "åˆ†" + ('0' +today.getSeconds()).slice(-2) + "ç§’"
// );


// é€ä¿¡å‡¦ç†
$('#send').on('click', function(){
      // alert(1)//å‹•ã„ãŸã‚‰alertã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼
      // é€ä¿¡ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ğŸ¤—

      // id='uname' ã¤ã¾ã‚Š #uname åå‰ã®ã¨ã“ã‚
      // id='text' ã¤ã¾ã‚Š #text ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã¨ã“ã‚
      const text = $('#text').val();
      const uname = $('#uname').val();

      // ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œæˆã—ã¦ã„ã‚‹
      const msg = {
       uname: $('#uname').val(),
       text: $('#text').val(), 
      }

      //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ = çµ¶å¯¾ã«ã‹ã¶ã‚‰ãªã„ç•ªå·ã¿ãŸã„ãªã‚‚ã®
      const newPostRef = push(dbRef);
      //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
      set(newPostRef, msg);
      // alert(uname + text);ã€€å…¥åŠ›ã®ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¾ã—ãŸ
    });

// é€ä¿¡å‡¦ç†ï¼’
$("#text").on("keydown",function(e){
     console.log(e);
    if(e.keyCode==13){
        const text = $('#text').val();
        const uname = $('#uname').val();

      // ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œæˆã—ã¦ã„ã‚‹
        const msg = {
        uname: $('#uname').val(),
        text: $('#text').val(), 
      }
      //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ = çµ¶å¯¾ã«ã‹ã¶ã‚‰ãªã„ç•ªå·ã¿ãŸã„ãªã‚‚ã®
      const newPostRef = push(dbRef);
      //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
      set(newPostRef, msg);
      // alert(uname + text);ã€€å…¥åŠ›ã®ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¾ã—ãŸ
    }
});


//å—ä¿¡å‡¦ç†
onChildAdded(dbRef, function (data) {
        const msg = data.val();
        const key = data.key; //ã“ã‚ŒãŒå›ºæœ‰ã®éµ

        console.log(key, 'éµ')
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
        let hh = `
        <div class="message" data-key=${key}>
          <input type="text" value=${msg.uname} class="uname"/>
          <input type="text" value=${msg.text} class="text"/>
          <p class="update">æ›´æ–°</p>
          <p class="delete">å‰Šé™¤</p>
        </div>`;
        //ã“ã®ä¸€ã¤ã®å¡ŠãŒã€Œéµã€ã‚’è¡¨ã—ã¦ã‚‹

        $("#output").append(hh);
      });

$(document).on("click", ".delete", function(){
        //ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ªã®éµã‚’å–å¾—ã™ã‚‹
        var v = $(this).parent().data().key;

        console.log(v, 'vvv') //-MrWxLlpH8HdF7WXK_U9

        //vã¯éµ
        remove(ref(db, 'chat/' + v));

        //htmlã‚’æ¶ˆã™æ–¹æ³•
        $(this).parent().remove();
      });

// æ›´æ–°
$(document).on("click", ".update", function(){
        var v = $(this).parent().data().key;

        var nameValue = $(this).siblings('.uname').val();
        var textValue = $(this).siblings('.text').val();

        console.log(nameValue, 'åŒã˜åˆ—')
        console.log(textValue, 'åŒã˜åˆ—')
        //ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ªã®éµã‚’å–å¾—ã™ã‚‹

//æ›´æ–°å‡¦ç†
        set(ref(db, 'chat/' + v), {
          uname: nameValue,
          text: textValue,
        })
      });

// å‰Šé™¤å‡¦ç†
$(document).on("click", ".delete", function(){
        var v = $(this).parent().data().key;
        console.log(v, 'vvv') //-MrWxLlpH8HdF7WXK_U9

        //vã¯éµ

      });




// //å—ä¿¡å‡¦ç†ï¼ˆæˆæ¥­ï¼‰
// onChildAdded(dbRef, function (data) {
//         const msg = data.val();
//         const key = data.key;ã€€//ã“ã‚ŒãŒå›ºæœ‰ã®éµ

//         console.log(key, 'éµ')

//         // let h = "<p>";
//         // h += msg.uname;
//         // h += "<br>";
//         // h += msg.text;
//         // h += "</p>";

//         // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
//         let hh = `
//         <div class="message" data-key=${key}>
//           <p>${msg.uname}</p>
//           <p>${msg.text}</p>
//           <p class="delete">å‰Šé™¤</p>
//         </div>`;
//         //ã“ã®ä¸€ã¤ã®å¡ŠãŒã€Œéµã€ã‚’è¡¨ã—ã¦ã‚‹

//         $("#output").append(hh);
//       });




// $('#delete').on('click', function(){
//       // alert(1)//å‹•ã„ãŸã‚‰alertã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼
//       // é€ä¿¡ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ğŸ¤—

//       // id='uname' ã¤ã¾ã‚Š #uname åå‰ã®ã¨ã“ã‚
//       // id='text' ã¤ã¾ã‚Š #text ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã¨ã“ã‚
//       const text = $('#text').val();
//       const uname = $('#uname').val();

//       // ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œæˆã—ã¦ã„ã‚‹
//       const msg = {
//        uname: $('#uname').val(),
//        text: $('#text').val(), 
//       }

//       //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ = çµ¶å¯¾ã«ã‹ã¶ã‚‰ãªã„ç•ªå·ã¿ãŸã„ãªã‚‚ã®
//       const newPostRef = push(dbRef);
//       //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
//       set(newPostRef, msg);
      
//       // alert(uname + text);ã€€å…¥åŠ›ã®ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¾ã—ãŸ
//     });

</script>

</body>
</html>